import{cA as w,j as t,w as P,v as F,x as y,_ as A,r as p,y as z,z as S,E as B,H as G,Y,a as h,a8 as j,cB as H,cC as U,cD as k,cE as W,cF as V,G as N,bl as q,b0 as Z,b2 as K,b4 as X,B as L,cf as _,bX as O,bY as $,q as Q}from"./index-a584ef0b.js";import{D as J}from"./DataTable-38a000d7.js";const ee=w(t.jsx("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"}),"Person");function te(e){return P("MuiAvatar",e)}F("MuiAvatar",["root","colorDefault","circular","rounded","square","img","fallback"]);const re=["alt","children","className","component","imgProps","sizes","src","srcSet","variant"],se=e=>{const{classes:r,variant:n,colorDefault:s}=e;return G({root:["root",n,s&&"colorDefault"],img:["img"],fallback:["fallback"]},te,r)},ne=y("div",{name:"MuiAvatar",slot:"Root",overridesResolver:(e,r)=>{const{ownerState:n}=e;return[r.root,r[n.variant],n.colorDefault&&r.colorDefault]}})(({theme:e,ownerState:r})=>A({position:"relative",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,width:40,height:40,fontFamily:e.typography.fontFamily,fontSize:e.typography.pxToRem(20),lineHeight:1,borderRadius:"50%",overflow:"hidden",userSelect:"none"},r.variant==="rounded"&&{borderRadius:(e.vars||e).shape.borderRadius},r.variant==="square"&&{borderRadius:0},r.colorDefault&&A({color:(e.vars||e).palette.background.default},e.vars?{backgroundColor:e.vars.palette.Avatar.defaultBg}:{backgroundColor:e.palette.mode==="light"?e.palette.grey[400]:e.palette.grey[600]}))),ae=y("img",{name:"MuiAvatar",slot:"Img",overridesResolver:(e,r)=>r.img})({width:"100%",height:"100%",textAlign:"center",objectFit:"cover",color:"transparent",textIndent:1e4}),oe=y(ee,{name:"MuiAvatar",slot:"Fallback",overridesResolver:(e,r)=>r.fallback})({width:"75%",height:"75%"});function ie({crossOrigin:e,referrerPolicy:r,src:n,srcSet:s}){const[o,u]=p.useState(!1);return p.useEffect(()=>{if(!n&&!s)return;u(!1);let g=!0;const l=new Image;return l.onload=()=>{g&&u("loaded")},l.onerror=()=>{g&&u("error")},l.crossOrigin=e,l.referrerPolicy=r,l.src=n,s&&(l.srcset=s),()=>{g=!1}},[e,r,n,s]),o}const le=p.forwardRef(function(r,n){const s=z({props:r,name:"MuiAvatar"}),{alt:o,children:u,className:g,component:l="div",imgProps:D,sizes:c,src:f,srcSet:m,variant:I="circular"}=s,E=S(s,re);let d=null;const a=ie(A({},D,{src:f,srcSet:m})),x=f||m,C=x&&a!=="error",R=A({},s,{colorDefault:!C,component:l,variant:I}),T=se(R);return C?d=t.jsx(ae,A({alt:o,src:f,srcSet:m,sizes:c,ownerState:R,className:T.img},D)):u!=null?d=u:x&&o?d=o[0]:d=t.jsx(oe,{ownerState:R,className:T.fallback}),t.jsx(ne,A({as:l,ownerState:R,className:B(T.root,g),ref:n},E,{children:d}))}),b=le,ce=({onDrop:e})=>{const r=Y(),n=p.useRef(null),[s,o]=p.useState(!1),[u,g]=p.useState(!1),l=a=>{n.current&&n.current.click()},D=a=>{var x;return e((x=n.current)==null?void 0:x.files)},c=a=>{a.preventDefault(),e(a.dataTransfer.files),o(!1)},f=a=>{a.preventDefault(),o(!0)},m=a=>{a.preventDefault(),o(!1)},I=a=>a.preventDefault(),E=a=>g(!0),d=a=>g(!1);return t.jsxs(h,{height:300,borderRadius:1,border:2,px:20,position:"relative",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",bgcolor:u||s?r.palette.grey[300]:r.palette.grey[200],color:r.palette.grey[600],borderColor:r.palette.grey[400],fontWeight:"bold",textAlign:"center",children:[t.jsx("input",{"data-testid":"ingest-file-upload",ref:n,type:"file",multiple:!0,onChange:D,hidden:!0}),t.jsx(j,{icon:s?H:U,size:"3x"}),t.jsx("p",{children:"Click here or drag and drop to upload files"}),t.jsx(h,{position:"absolute",width:"100%",height:"100%",onClick:l,onDragEnter:f,onDragLeave:m,onDragOver:I,onMouseEnter:E,onMouseLeave:d,onDrop:c})]})};var v=(e=>(e[e.READY=0]="READY",e[e.UPLOADING=1]="UPLOADING",e[e.FAILURE=2]="FAILURE",e[e.DONE=3]="DONE",e))(v||{}),i=(e=>(e[e.ADD_FILES=0]="ADD_FILES",e[e.CONFIRMATION=1]="CONFIRMATION",e[e.UPLOAD=2]="UPLOAD",e))(i||{});const de=({file:e})=>{var r;return(r=e.errors)!=null&&r.length?t.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:1},children:[t.jsx(b,{sx:{bgcolor:"red",width:24,height:24},children:t.jsx(j,{icon:k,size:"xs",color:"white"})}),t.jsx("div",{children:e.errors.map((n,s)=>t.jsx("div",{children:n},s))})]}):e.status===v.UPLOADING?t.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:1},children:[t.jsx(h,{sx:{animation:"spin 2s linear infinite","@keyframes spin":{"0%":{transform:"rotate(0deg)"},"100%":{transform:"rotate(360deg)"}}},children:t.jsx(j,{icon:W,size:"sm",color:"grey"})}),t.jsx("div",{children:"Uploading..."})]}):t.jsxs(h,{sx:{display:"flex",alignItems:"center",gap:1},children:[t.jsx(b,{sx:{bgcolor:"green",width:24,height:24},children:t.jsx(j,{icon:V,transform:"shrink-1",size:"xs",color:"white"})}),t.jsx("div",{children:e.status===v.READY?"Ready":"Done"})]})},ue=({file:e,onRemove:r})=>t.jsxs(N,{container:!0,width:"100%",minHeight:32,fontSize:12,borderLeft:1,borderRight:1,borderBottom:1,borderColor:"lightgray",children:[t.jsx(N,{item:!0,xs:6,sx:{display:"flex",alignItems:"center",paddingLeft:"4px"},children:e.file.name}),t.jsx(N,{item:!0,xs:5,sx:{display:"flex",alignItems:"center"},children:t.jsx(de,{file:e})}),e.status===v.READY&&t.jsx(N,{item:!0,xs:1,sx:{display:"flex",alignItems:"center",justifyContent:"end"},children:t.jsx(q,{onClick:r,sx:{"&:hover":{backgroundColor:"lightgray"},borderRadius:"2px",width:28,height:28,margin:"2px"},children:t.jsx(j,{size:"xs",icon:k})})})]}),ge=1e9,he=["application/json"],fe=e=>{const r=[];return e.size>ge&&r.push("File cannot be larger than 1 GB"),he.includes(e.type)||r.push("File must be valid JSON"),r},Ae=({files:e,open:r,submitDisabled:n,onClose:s,onAppendFiles:o,onRemoveFile:u,onUpload:g,onExited:l=()=>{},uploadMessage:D=""})=>{const[c,f]=p.useState(i.ADD_FILES),m=d=>{if(d&&d.length>0){const a=[...d].map(x=>{const C=fe(x);return C.length>0?{file:x,errors:C,status:v.READY}:{file:x,status:v.READY}});o(a)}},I=()=>{s()},E=()=>{c===i.ADD_FILES?f(i.CONFIRMATION):c===i.CONFIRMATION&&(f(i.UPLOAD),g())};return t.jsxs(Z,{open:r,fullWidth:!0,maxWidth:"sm",TransitionProps:{onExited:()=>{f(i.ADD_FILES),l()}},children:[t.jsx(K,{children:t.jsxs(t.Fragment,{children:[c===i.ADD_FILES&&t.jsx(ce,{onDrop:m}),(c===i.CONFIRMATION||c===i.UPLOAD)&&t.jsx(h,{fontSize:20,marginBottom:5,children:D||"The following files will be uploaded and ingested into BloodHound. This cannot be undone."}),e.length>0&&t.jsxs(h,{sx:{marginTop:1,marginBottom:1},children:[t.jsx(h,{sx:{backgroundColor:"black",color:"white",fontWeight:"bold",padding:"4px"},children:"Files"}),e.map((d,a)=>t.jsx(ue,{file:d,onRemove:()=>u(a)},a))]}),c===i.CONFIRMATION&&t.jsx(h,{fontSize:20,marginTop:3,children:'Press "Upload" to continue.'})]})}),t.jsxs(X,{children:[(c===i.ADD_FILES||c===i.CONFIRMATION)&&t.jsxs(t.Fragment,{children:[t.jsx(L,{autoFocus:!0,color:"inherit",onClick:I,"data-testid":"confirmation-dialog_button-no",children:"Cancel"}),t.jsx(L,{color:"primary",disabled:n,onClick:E,"data-testid":"confirmation-dialog_button-yes",children:"Upload"})]}),c===i.UPLOAD&&t.jsx(L,{color:"primary",onClick:I,disabled:n,"data-testid":"confirmation-dialog_button-yes",children:n?"Uploading Files":"Close"})]})]})};var xe=(e=>(e[e.INVALID=-1]="INVALID",e[e.READY=0]="READY",e[e.RUNNING=1]="RUNNING",e[e.COMPLETE=2]="COMPLETE",e[e.CANCELED=3]="CANCELED",e[e.TIMED_OUT=4]="TIMED_OUT",e[e.FAILED=5]="FAILED",e[e.INGESTING=6]="INGESTING",e))(xe||{});const me={[-1]:"Invalid",0:"Ready",1:"Running",2:"Complete",3:"Canceled",4:"Timed Out",5:"Failed",6:"Ingesting"},M="0001-01-01T00:00:00Z",pe=[{label:"User"},{label:"Start Time"},{label:"End Time"},{label:"Duration"},{label:"Status"},{label:"Status Message"}],ve=({ingestJobs:e,paginationProps:r})=>{const n=e.sort((s,o)=>o.id-s.id).map((s,o)=>[s.user_email_address,_.fromISO(s.start_time).toFormat(O.DATETIME_WITH_LINEBREAKS),s.end_time===M?"":_.fromISO(s.end_time).toFormat(O.DATETIME_WITH_LINEBREAKS),s.end_time===M?"":$(s.start_time,s.end_time),me[s.status],s.status_message]);return t.jsx(Q,{children:t.jsx(J,{headers:pe,data:n,showPaginationControls:!0,paginationProps:r})})};export{Ae as F,ve as a,v as b,i as c,xe as d,me as e};
