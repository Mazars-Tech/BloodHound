import{u as Y,r as i,d as _,j as n,a as $,B as k,h as u,aY as g}from"./index-a584ef0b.js";import{C as b}from"./ContentPage-b5dcd0a0.js";import{b as r,a as G,F as H}from"./FinishedIngestLog-6e60ddd6.js";import{u as T}from"./useToggle-e96e3749.js";import"./DataTable-38a000d7.js";import"./TableContainer-2d43236c.js";import"./KeyboardArrowRight-6e82a04f.js";const Q=()=>{const d=Y(),[o,l]=i.useState([]),[x,h]=i.useState(!1),[S,U]=i.useState(""),[w,F]=T(!1),[p,m]=i.useState(0),[c,y]=i.useState(10),[E,P]=i.useState(0),{data:f,refetch:D}=_(["listFileIngestJobs",p,c],()=>u.listFileIngestJobs(p*c,c,"-id").then(e=>{var t;return P(((t=e.data)==null?void 0:t.count)||0),e.data}),{refetchInterval:5e3}),j=(e,t)=>{m(t)},v=e=>{y(parseInt(e.target.value,10)),m(0)};i.useEffect(()=>{const e=o.filter(s=>s.errors).length>0,t=o.filter(s=>s.status===r.UPLOADING).length>0;e||t||!o.length?h(!0):h(!1)},[o]);const A=e=>{l(t=>t.filter((s,a)=>a!==e))},C=e=>{l(t=>[...t,...e])},R=e=>{l(t=>t.map(s=>({...s,status:s.status===r.READY?e:s.status})))},I=(e,t)=>{l(s=>s.map(a=>a.file.name===e?{...a,status:t}:a))},O=(e,t)=>{I(e,r.FAILURE),l(s=>s.map(a=>a.file.name===e?{...a,error:[t]}:a))},J=async()=>{try{R(r.UPLOADING);const e=await L();for(const t of o)await N(e,t);await M(e)}catch(e){console.error(e)}},L=async()=>{try{return await(await u.startFileIngest()).data.data.id}catch{throw d(g("Failed to start ingest process","StartFileIngestFail")),l(t=>t.map(s=>({...s,status:r.READY}))),new Error("Failed to start file upload")}},N=async(e,t)=>{try{const s=await t.file.text();await u.uploadFileToIngestJob(e,JSON.parse(s)),I(t.file.name,r.DONE)}catch{d(g(`File upload failed for ${t.file.name}`,"IngestFileUploadFail")),O(t.file.name,"Upload Failed")}},M=async e=>{try{const t=o.filter(a=>a.errors),s=t.length>0?"Some files have failed to upload and have not been included for ingest.":"All files have successfully been uploaded for ingest.";await u.endFileIngest(e),D(),U(s),d(g(`Successfully uploaded ${o.length-t.length} files for ingest`,"FileIngestSuccess"))}catch{d(g("Failed to close out ingest job","EndFileIngestFail"))}},B=()=>l([]);return n.jsxs(n.Fragment,{children:[n.jsx(b,{title:"Manual File Ingest","data-testid":"manual-file-ingest",children:n.jsx($,{display:"flex",justifyContent:"flex-end",alignItems:"center",minHeight:"24px",mb:2,children:n.jsx(k,{color:"primary",variant:"contained",disableElevation:!0,onClick:()=>F(),"data-testid":"file-ingest_button-upload-files",children:"Upload File(s)"})})}),n.jsx(b,{title:"Finished Ingest Log","data-testid":"finished-ingest-log",children:n.jsx(G,{ingestJobs:(f==null?void 0:f.data)||[],paginationProps:{page:p,rowsPerPage:c,count:E,onPageChange:j,onRowsPerPageChange:v}})}),n.jsx(H,{open:w,onClose:F,files:o,submitDisabled:x,onAppendFiles:C,onRemoveFile:A,onUpload:J,onExited:B,uploadMessage:S})]})},ee=Q;export{ee as default};
