import{cG as J,cH as G,j as e,cI as j,a as v,aK as V,cJ as X,d as E,h as z,an as W,r as c,q as A,cK as w,cL as F,cM as C,ap as o,a8 as d,cN as Y,cO as b,cP as H,cQ as U,A as L,bB as q,B as I,cR as ee,T as te,M as Q,cS as se,s as ae,cT as B,cU as Z,aL as ie,ao as y,c as re,k as R,G as O}from"./index-a584ef0b.js";import{C as M}from"./ContentPage-b5dcd0a0.js";import{T as f}from"./TableContainer-2d43236c.js";import{u as le}from"./useAvailableDomains-f6141468.js";const N=J({root:{"&:last-child":{borderBottom:"none"}}})(G),r=({icon:t,value:s=0,display:i,type:a="number",loading:l})=>l?e.jsxs(N,{children:[e.jsxs(j,{children:[e.jsx(v,{display:"inline-block",width:"32px",textAlign:"center",children:t}),i]}),e.jsx(j,{align:"right",children:e.jsx(V,{variant:"text"})})]}):e.jsxs(N,{children:[e.jsxs(j,{children:[e.jsx(v,{display:"inline-block",width:"32px",textAlign:"center",children:t}),i]}),e.jsx(j,{align:"right",children:a==="percent"?`${Math.floor(s*100)}%`:s.toLocaleString()})]});X.now();const ne=t=>E(["active-directory-data-quality-stats",t],({signal:s})=>z.getADQualityStats(t,void 0,void 0,1,void 0,{signal:s}).then(i=>{if(!i.data)throw new Error("Unable to retrieve AD quality stats");return i.data})),oe=t=>E(["azure-data-quality-stats",t],({signal:s})=>z.getAzureQualityStats(t,void 0,void 0,1,void 0,{signal:s}).then(i=>{if(!i.data)throw new Error("Unable to retrieve Azure quality stats");return i.data})),ce=()=>E("active-directory-platform-data-quality-stats",({signal:t})=>z.getPlatformQualityStats("ad",void 0,void 0,1,void 0,{signal:t}).then(s=>{if(!s.data)throw new Error("Unable to retrieve AD platform quality stats");return s.data})),ue=()=>E("azure-platform-data-quality-stats",({signal:t})=>z.getPlatformQualityStats("azure",void 0,void 0,1,void 0,{signal:t}).then(s=>{if(!s.data)throw new Error("Unable to retrieve Azure platform quality stats");return s.data})),pe=W({print:{"@media print":{display:"none"}}}),xe=({contextId:t,headers:s=!1,onDataError:i=()=>{}})=>{const{data:a,isLoading:l,isError:u}=ne(t),[p,x]=c.useState(a||null);if(c.useEffect(()=>{a&&a.data&&x(a)},[a,t]),c.useEffect(()=>{u&&i()},[u,i]),l||!p)return e.jsx(T,{dbInfo:null,isPlatform:!1,headers:s,loading:!0});if(u)return e.jsx(T,{dbInfo:null,isPlatform:!1,headers:s,loading:!1});const h=p.data[0];return e.jsx(T,{dbInfo:h,headers:s,loading:!1})},ye=({onDataError:t=()=>{}})=>{const{data:s,isLoading:i,isError:a}=ce(),[l,u]=c.useState(s||null);if(c.useEffect(()=>{s&&s.data&&u(s)},[s]),c.useEffect(()=>{a&&t()},[a,t]),i)return e.jsx(T,{dbInfo:null,isPlatform:!0,loading:!0});if(a||!l)return e.jsx(T,{dbInfo:null,isPlatform:!0,loading:!1});const p=l.data[0];return e.jsx(T,{dbInfo:p,isPlatform:!0,loading:!1})},T=({dbInfo:t,loading:s,isPlatform:i,headers:a})=>{const l=pe();return e.jsxs(v,{position:"relative",children:[e.jsx(f,{component:A,children:e.jsxs(w,{children:[a&&e.jsx(F,{className:l.print,children:e.jsxs(G,{children:[e.jsx(j,{align:"left",children:"Item"}),e.jsx(j,{align:"right",children:"Result"})]})}),e.jsxs(C,{children:[e.jsx(r,{icon:e.jsx(o,{nodeType:"User"}),display:"Users",value:(t==null?void 0:t.users)||0,loading:s}),e.jsx(r,{icon:e.jsx(o,{nodeType:"Group"}),display:"Groups",value:(t==null?void 0:t.groups)||0,loading:s}),e.jsx(r,{icon:e.jsx(o,{nodeType:"Computer"}),display:"Computers",value:(t==null?void 0:t.computers)||0}),e.jsx(r,{icon:e.jsx(o,{nodeType:"OU"}),display:"OUs",value:(t==null?void 0:t.ous)||0,loading:s}),e.jsx(r,{icon:e.jsx(o,{nodeType:"GPO"}),display:"GPOs",value:(t==null?void 0:t.gpos)||0,loading:s}),e.jsx(r,{icon:e.jsx(o,{nodeType:"Container"}),display:"Containers",value:(t==null?void 0:t.containers)||0,loading:s}),i&&e.jsx(r,{icon:e.jsx(o,{nodeType:"Domain"}),display:"Domains",value:(t==null?void 0:t.domains)||0,loading:s})]})]})}),e.jsx(f,{style:{marginTop:"16px"},component:A,children:e.jsx(w,{children:e.jsxs(C,{children:[e.jsx(r,{icon:e.jsx(d,{icon:Y}),display:"Sessions",value:(t==null?void 0:t.sessions)||0,loading:s}),e.jsx(r,{icon:e.jsx(d,{icon:b}),display:"ACLs",value:(t==null?void 0:t.acls)||0,loading:s}),e.jsx(r,{icon:e.jsx(d,{icon:H}),display:"Relationships",value:(t==null?void 0:t.relationships)||0,loading:s})]})})}),e.jsx(f,{style:{marginTop:"16px"},component:A,children:e.jsx(w,{children:e.jsxs(C,{children:[e.jsx(r,{icon:e.jsx(d,{icon:U}),display:"Group Completeness",value:(t==null?void 0:t.local_group_completeness)||0,loading:s,type:"percent"}),e.jsx(r,{icon:e.jsx(d,{icon:U}),display:"Session Completeness",value:(t==null?void 0:t.session_completeness)||0,loading:s,type:"percent"})]})})})]})},K=({value:t,onChange:s=()=>{},fullWidth:i=!1})=>{const[a,l]=c.useState(null),[u,p]=c.useState(""),{data:x,isLoading:h,isError:m}=le();if(h)return e.jsx(V,{variant:"rounded",height:36,width:256});if(m)return e.jsxs(L,{severity:"error",children:["Domains unavailable. See the"," ",e.jsx(q,{target:"_blank",href:"https://support.bloodhoundenterprise.io/hc/en-us/categories/9270370014875-Data-Collection",children:"Data Collection"})," ","page to view instructions on how to begin data collection."]});const S=n=>{l(n.currentTarget)},P=()=>{l(null)},$=!!a,_=x.filter(n=>n.name.toLowerCase().includes(u.toLowerCase()));let g;if(t.type==="active-directory-platform")g="All Active Directory Domains";else if(t.type==="azure-platform")g="All Azure Tenants";else{const n=x==null?void 0:x.find(k=>k.id===t.id);n?g=n.name:g="Unknown Domain or Tenant"}return e.jsxs(v,{"data-testid":"data-selector",p:1,children:[e.jsx(I,{sx:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",display:"block"},fullWidth:i,variant:"contained",disableElevation:!0,color:"primary",onClick:S,"data-testid":"data-quality_context-selector",children:g!==null?g:"Select Context"}),e.jsxs(ee,{open:$,anchorEl:a,onClose:P,anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"},"data-testid":"data-quality_context-selector-popover",children:[e.jsx(v,{display:"flex",padding:"0px 16px",children:e.jsx(te,{autoFocus:!0,value:u,onChange:n=>{p(n.target.value)},variant:"standard",fullWidth:!0,label:"Search","data-testid":"data-quality_context-selector-search"})}),_&&_.sort((n,k)=>n.name.localeCompare(k.name)).map(n=>n.collected?e.jsxs(Q,{style:{display:"flex",justifyContent:"space-between",width:450,maxWidth:450},onClick:()=>{s({type:n.type,id:n.id}),P()},children:[e.jsx(se,{title:n.name,children:e.jsx(ae,{style:{overflow:"hidden",textTransform:"uppercase",display:"inline-block",textOverflow:"ellipsis",maxWidth:350},children:n.name})}),e.jsx(d,{style:{width:"10%",alignSelf:"center"},icon:n.type==="azure"?B:Z,size:"sm"})]},n.id):null),e.jsx(ie,{}),e.jsxs(Q,{style:{display:"flex",justifyContent:"space-between"},onClick:()=>{s({type:"active-directory-platform",id:null}),P()},children:["All Active Directory Domains",e.jsx(d,{style:{width:"10%",alignSelf:"center",marginLeft:"8px"},icon:Z,size:"sm"})]}),e.jsxs(Q,{style:{display:"flex",justifyContent:"space-between"},onClick:()=>{s({type:"azure-platform",id:null}),P()},children:["All Azure Tenants",e.jsx(d,{style:{width:"10%",alignSelf:"center",marginLeft:"8px"},icon:B,size:"sm"})]})]})]})},de=W({print:{"@media print":{display:"none"}}}),je=({contextId:t,headers:s=!1,onDataError:i=()=>{}})=>{const{data:a,isLoading:l,isError:u}=oe(t),[p,x]=c.useState(a||null);if(c.useEffect(()=>{a&&a.data&&x(a)},[a,t]),c.useEffect(()=>{u&&i()},[u,i]),l)return e.jsx(D,{dbInfo:null,isPlatform:!1,headers:s,loading:!0});if(u||!p)return e.jsx(D,{dbInfo:null,isPlatform:!1,headers:s,loading:!1});const h=p.data[0];return e.jsx(D,{dbInfo:h,headers:s,loading:!1})},he=({onDataError:t=()=>{}})=>{const{data:s,isLoading:i,isError:a}=ue(),[l,u]=c.useState(s||null);if(c.useEffect(()=>{s&&s.data&&u(s)},[s]),c.useEffect(()=>{a&&t()},[a,t]),i||!l)return e.jsx(D,{dbInfo:null,isPlatform:!0,loading:!0});if(a)return e.jsx(D,{dbInfo:null,isPlatform:!0,loading:!1});const p=l.data[0];return e.jsx(D,{dbInfo:p,isPlatform:!0,loading:!1})},D=({dbInfo:t,loading:s,isPlatform:i,headers:a})=>{const l=de();return e.jsxs(v,{position:"relative",children:[e.jsx(f,{component:A,children:e.jsxs(w,{children:[a&&e.jsx(F,{className:l.print,children:e.jsxs(G,{children:[e.jsx(j,{align:"left",children:"Item"}),e.jsx(j,{align:"right",children:"Result"})]})}),e.jsxs(C,{children:[e.jsx(r,{icon:e.jsx(o,{nodeType:y.AZUser}),display:"Users",value:(t==null?void 0:t.users)||0,loading:s}),e.jsx(r,{icon:e.jsx(o,{nodeType:y.AZGroup}),display:"Groups",value:(t==null?void 0:t.groups)||0,loading:s}),e.jsx(r,{icon:e.jsx(o,{nodeType:y.AZApp}),display:"Apps",value:(t==null?void 0:t.apps)||0,loading:s}),e.jsx(r,{icon:e.jsx(o,{nodeType:y.AZServicePrincipal}),display:"Service Principals",value:(t==null?void 0:t.service_principals)||0,loading:s}),e.jsx(r,{icon:e.jsx(o,{nodeType:y.AZDevice}),display:"Devices",value:(t==null?void 0:t.devices)||0,loading:s}),e.jsx(r,{icon:e.jsx(o,{nodeType:y.AZManagementGroup}),display:"Management Groups",value:(t==null?void 0:t.management_groups)||0,loading:s}),e.jsx(r,{icon:e.jsx(o,{nodeType:y.AZSubscription}),display:"Subscriptions",value:(t==null?void 0:t.subscriptions)||0,loading:s}),e.jsx(r,{icon:e.jsx(o,{nodeType:y.AZResourceGroup}),display:"Resource Groups",value:(t==null?void 0:t.resource_groups)||0,loading:s}),e.jsx(r,{icon:e.jsx(o,{nodeType:y.AZVM}),display:"VMs",value:(t==null?void 0:t.vms)||0,loading:s}),e.jsx(r,{icon:e.jsx(o,{nodeType:y.AZKeyVault}),display:"Key Vaults",value:(t==null?void 0:t.key_vaults)||0,loading:s}),i&&e.jsx(r,{icon:e.jsx(o,{nodeType:y.AZTenant}),display:"Tenants",value:(t==null?void 0:t.tenants)||0,loading:s})]})]})}),e.jsx(f,{style:{marginTop:"16px"},component:A,children:e.jsx(w,{children:e.jsx(C,{children:e.jsx(r,{icon:e.jsx(d,{icon:H}),display:"Relationships",value:(t==null?void 0:t.relationships)||0,loading:s})})})})]})},me=()=>{const t=re(m=>m.global.options.domain),[s,i]=c.useState((t==null?void 0:t.type)||null),[a,l]=c.useState((t==null?void 0:t.id)||null),[u,p]=c.useState(!1);c.useEffect(()=>{p(!1)},[a,s]);const x=()=>{p(!0)},h=()=>{switch(s){case"active-directory":return e.jsx(xe,{contextId:a,onDataError:x});case"active-directory-platform":return e.jsx(ye,{onDataError:x});case"azure":return e.jsx(je,{contextId:a,onDataError:x});case"azure-platform":return e.jsx(he,{onDataError:x});default:return null}};return!s||!a&&(s==="active-directory"||s==="azure")?e.jsx(M,{title:"Data Quality","data-testid":"data-quality",actionButton:e.jsx(K,{value:{type:s,id:a},onChange:({type:m,id:S})=>{i(m),l(S)}}),children:e.jsxs(L,{severity:"info",children:[e.jsx(R,{children:"No Domain or Tenant Selected"}),"Select a domain or tenant to view data. If you are unable to select a domain, you may need to run data collection first. See the"," ",e.jsx(q,{target:"_blank",href:"https://support.bloodhoundenterprise.io/hc/en-us/categories/9270370014875-Data-Collection",children:"Data Collection"})," ","page to view instructions on how to begin data collection."]})}):e.jsxs(M,{title:"Data Quality","data-testid":"data-quality",actionButton:e.jsx(K,{value:{type:s,id:a},onChange:({type:m,id:S})=>{i(m),l(S)}}),children:[u&&e.jsx(v,{paddingBottom:2,children:e.jsxs(L,{severity:"warning",children:[e.jsx(R,{children:"Data Quality Warning"}),"It looks like data is incomplete or hasn't been collected yet. See the"," ",e.jsx(q,{target:"_blank",href:"https://support.bloodhoundenterprise.io/hc/en-us/categories/9270370014875-Data-Collection",children:"Data Collection"})," ","page to view instructions on how to begin data collection."]})}),e.jsx(O,{container:!0,spacing:2,children:e.jsx(O,{item:!0,xs:12,"data-testid":"data-quality_statistics",children:h()})})]})},Se=me;export{Se as default};
